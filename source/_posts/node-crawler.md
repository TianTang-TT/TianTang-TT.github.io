---
title: node爬虫抓取知乎动态
date: 2016-12-22 16:12:20
categories: Node
tags: [node, spider, crawler]
keywords: ['node 爬虫', 'node crawler', 'node spider', '知乎爬虫', '爬虫抓取知乎用户数据', '用nodejs写爬虫']
---

### 前言
> 以前一直以为爬虫是一种很高级的黑客手段，显得很神秘，近来有空，便想用nodejs来写一个小爬虫一探究竟。


<!--more-->

### 主要构想
> nodejs为前端接触后端架起了一座桥梁，现在后端能做的很多事情，我们用nodejs也能来实现，比如爬虫。作为前端工程师，我选用nodejs
  来实现这个小爬虫。此文中以spider来代替该爬虫。spider的主要作用是用来爬取自己知乎账号的最近动态，获取自己的基本资料，然后抓取两百条数据
  来分析自己最近都做了哪些操作，当然，你可以抓取更多，这是可以配置的。控制台的数据可视化并不是很好，因此用express搭建了简单的服务器，通过浏览器
  来预览爬虫的抓取结果。

### 使用模块

##### superagent

> 发起http请求，请求知乎接口来获取数据

##### cheerio

> 抓取页面后操作dom来提取页面中的数据，api及用法跟jquery类似

##### express

> 用来起简单的服务，以便于在浏览器中查看爬虫抓取的的数据

##### jade

> 页面模板引擎

### 使用方法
1. 克隆该仓库到本地，然后安装相应的模块
2. 执行`node app`来启动服务
3. 打开浏览器，输入`localhost:3000`便可查看效果

### 分析

  整个爬虫其实很简单，主要作用就是发送请求收集数据然后进行分析，当然分析这一步不一定算到爬虫里面，可以自己写别的模块来进行数据的分析和加工。用`superagent`请求知乎接口拿到特定的数据，然而有的接口是有限的，有的数据是通过服务端渲染直接显示在页面上的，不能通过知乎的接口直接拿到，所以需要从渲染好的页面上进行抓取，因此需要用到`cheerio`模块来进行dom操作，拿到相应的dom结构然后取值。这里需要注意的是这种需要登录的网站请求可能会有权限验证，因此需要在发请求的时候为请求带上相应的cookie和authorization的数据，否则将请求就失败，为了获取cookie和authorization，所以做了一个登陆入口来获取相应的授权。


### 目录说明
![](http://7xt6mo.com1.z0.glb.clouddn.com/1482825152%281%29.jpg)

### 主要步骤
* 1. 通过邮箱密码验证码登陆获取授权，获取cookie以及authorization
* 2. 通过请求`zhihu.com`来获取用户id，然后用cheerio抓取出来进行后续的操作
* 3. 拿到userid之后就可以进行用户基本资料以及最近动态的请求

> 登陆和获取授权的过程有点麻烦，而且有验证码，所以只能通过express来做一个转发。有兴趣的可以直接看github代码及相应的注释，此处不详细讲代码


### demo test 效果
![](http://7xt6mo.com1.z0.glb.clouddn.com/L$R01XSEN%7D1TMRZM%28V98~XI.png)

### github地址
[带登陆功能的知乎爬虫](https://github.com/TianTang-TT/Spider)